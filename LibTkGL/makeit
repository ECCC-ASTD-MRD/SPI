#!/bin/sh
reconf=$1

MAKE=make
TCL=/cnfs/ops/cmoe/afsr005/Lib/7.6.0/${ORDENV_PLAT}/SPI

export CC=c99

echo ""
echo "----- Building platform : ${ORDENV_PLAT} -----"
echo ""

echo ""
echo "----- Making System Call Library Object -----"
echo ""
cd TclSystem
if [[ -n $reconf ]]; then
   make distclean
   ./configure \
      --exec-prefix=${TCL}/TclTk \
      --enable-threads \
      --enable-64bit \
      --with-tcl=${TCL}/TclTk/lib 
#      --with-dmv=/home/ordenv/ssm-domains/ssm-utils/dmv_1.0_linux26-x86-64
fi

$MAKE install

echo ""
echo "----- Making OpenGL Canvas Library Object -----"
echo ""
cd ../TkglCanvas
if [[ -n $reconf ]]; then
   make distclean
   ./configure \
      --prefix=${TCL}/TclTk/ \
      --exec-prefix=${TCL}/TclTk/ \
      --enable-threads \
      --enable-64bit \
      --with-tcl=${TCL}/TclTk/lib \
      --with-tk=${TCL}/TclTk/lib
fi

$MAKE install

echo ""
echo "----- Making Tcl GeoEER Library Object -----"
echo ""
cd ../TclGeoEER
if [[ -n $reconf ]]; then
   make distclean
   ./configure \
      --exec-prefix=${TCL}/TclTk \
      --enable-threads \
      --enable-64bit \
      --with-tcl=${TCL}/TclTk/lib \
      --with-tk=${TCL}/TclTk/lib \
      --with-eer=/home/afsr/005/Projects/libeerUtils \
      --with-rmn=/cnfs/ops/cmoe/afsr005/Lib/${BASE_ARCH}/librmn-13 \
      --with-gdb=/cnfs/ops/cmoe/afsr005/Lib/${BASE_ARCH}/gdb \
      --with-gdal=/cnfs/ops/cmoe/afsr005/Lib/${BASE_ARCH}/gdal-1.10.0/bin/gdal-config  \
      --with-grib=/cnfs/ops/cmoe/afsr005/Lib/${BASE_ARCH}/grib_api-1.9.18 \
      --with-ecbufr=/cnfs/ops/cmoe/afsr005/Lib/${BASE_ARCH}/libecbufr-0.8.4 \
      --with-flt=/cnfs/ops/cmoe/afsr005/Lib/${BASE_ARCH}/fltlib-0.5.1
#      --with-urp=/cnfs/ops/cmoe/afsr005/Lib/${BASE_ARCH}/URP
fi

$MAKE install

cd ${TCL}
ln -fs TclTk/lib/TclGeoEER7.6.0/libTclGeoEER7.6.0.so libTclGeoEER7.6.0.so
ln -fs libTclGeoEER7.6.0.so libTclGeoEER.so

ln -fs TclTk/lib/TkglCanvas8.6/libTkglCanvas8.6.so libTkglCanvas8.6.so
ln -fs libTkglCanvas8.6.so libTkglCanvas.so

ln -fs TclTk/lib/TclSystem1.0/libTclSystem1.0.so libTclSystem1.0.so
ln -fs libTclSystem1.0.so libTclSystem.so

