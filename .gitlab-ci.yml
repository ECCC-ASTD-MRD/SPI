variables:
    # CI_DEBUG_TRACE: "true"
    MIDAS_ABS: /home/erv000/data_maestro/ords/midas/gitlab-ci/abs

stages:
   - build
   #- test
   #- package
   #- deploy

## The program 'gitlab-runner' must be found in the PATH to get the artifacts collecting working.
#before_script:
#    - ln -svf /home/sidr000/bin/gitlab-ci-multi-runner-linux-amd64 ${TMPDIR}/bin
#    - ln -svf gitlab-ci-multi-runner-linux-amd64 ${TMPDIR}/bin/gitlab-runner

build:
   stage: build
   script:
      - cd libSPI
      - ./makeit -build -reconf
   only:
      - master

test:
   #stage: test
   #variables:
      #SPI_LIB=${SSM_DEV}/workspace/libSPI_8.0.0_${ORDENV_PLAT}
      #SPI_PATH=${HOME}/SPI-BETA
   #script:
      #- cd SPI/share/examples/script/
      #- suite=midas-$(echo ${CI_BUILD_REF} | cut -c-10)
      #- ./install_suite.sh $suite run $MIDAS_ABS
      #- ./wait4tests.sh $suite
      #- ./extractRunTime.sh $suite
      #- ./collect_unittest_listings
      #- clean_suite $suite
      #- rm ~/.suites/${suite}
   #only:
      #- master

package:
   stage: package
   script:
      - cd libSPI
      - ./makeit -ssm
      - cd ../SPI
      - ./makeit -ssm

deploy:
   stage: deploy
   script:
      - ssm install -d /ssm/net/cmds/apps/SPI/master -f $SSM_DEV/package/libSPI_8.0.0_ubuntu-14.04-amd64-64.ssm
      - ssm install -d /ssm/net/cmds/apps/SPI/master -f $SSM_DEV/package/SPI_8.0.0_all.ssm
      - ssm publish -d /ssm/net/cmds/apps/SPI/master -P /ssm/net/cmds/apps/SPI/beta -p libSPI_8.0.0_ubuntu-14.04-amd64-64
      - ssm publish -d /ssm/net/cmds/apps/SPI/master -P /ssm/net/cmds/apps/SPI/beta -p SPI_8.0.0_all
      
#doc:
  #stage: doc
  #variables:
    #docname: $CI_BUILD_REF_NAME-$CI_BUILD_REF
    #midasdoc: /home/erv000/public_html/midas-doc
  #script:
  #- scripts/create_f90doc.sh $CI_PROJECT_DIR/src $midasdoc/$docname
  #- rm -fv $midasdoc/latest
  #- ln -sv $midasdoc/$docname $midasdoc/latest
  #only:
    #- master